#!/bin/bash
# SPDX-License-Identifier: AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2023-2026 JWP Consulting GK
#
# Update requirements.txt and exit with status 1 if it has
# changed
if ! uv lock --check --quiet > /dev/null 2>&1
then
    echo "uv lock --check failed. Please fix any issues before using this tool"
    exit 1
fi

if ! uv export --format requirements.txt --no-emit-project --output-file requirements.txt > /dev/null; then
    echo "uv export failed."
    exit 1
fi

if ! git diff --exit-code --quiet HEAD -- requirements.txt; then
    echo "requirements.txt has changed"
    echo "Please commit"
    exit 1
fi
