#!/bin/bash
# SPDX-License-Identifier: AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2023-2026 JWP Consulting GK
#
# Update requirements.txt and exit with status 1 if it has
# changed
if ! uv tree --quiet > /dev/null 2>&1
then
    echo "uv tree failed. Please fix any issues before using this tool"
    exit 1
fi

uv export --format requirements-txt --output-file requirements.txt

if ! git diff --exit-code --quiet HEAD -- requirements.txt; then
    echo "requirements.txt has changed"
    echo "Please commit"
    exit 1
fi
